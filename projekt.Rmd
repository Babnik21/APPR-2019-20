---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Jure Babnik"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

V svoji projektni nalogi bom analiziral košarkarje lige NBA 
od leta 1980 naprej. Igralce bom analiziral na podlagi osebnih
podatkov, kot so višina, teža, rojstna država, ter njihove
statistike na tekmah (dosežene točke, skoki, asistence, itd.),
ter iskal povezave med njimi. Pred začetkom sem postavil tri 
hipoteze, katerih veljavnost želim preveriti.

1. Starejši igralci v povprečju zabeležijo manj izgubljenih žog (zaradi izkušenj)
2. Starejši igralci v povprečju zabeležijo manj skokov (zaradi 
slabše telesne pripravljenosti)
3. Višji igralci dosegajo več skokov ter blokad
4. Nižji igralci dosegajo več asistenc
5. Nižji igralci beležijo boljše odstotke meta iz igre ter 
prosih metov
6. Igralci, ki so igrali v ameriški študentski ligi so vstopili
v NBA bolje pripravljeni na profesionalno košarko (primerjava 
prvih sezon posameznih igralcev)
7. Evropski košarkarji igrajo "pametnejšo" košarko

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozili smo podatke o košarkarjih v obliki CSV s spletnega
portala Kaggle ter v obliki HTML s strani Basketball Reference.
Podatke imamo v dveh razpredelnicah v obliki *tidy data*. 
Večino kategorij najdemo v obeh razpredelnicah; razlika je, da 
so v drugi tabeli podatki preračunani, da predstavljajo 
statistiko, ki naj bi jo igralec dosegal z minutažo 36 minut na tekmo. 

1. `Player` - ime košarkarja
  - `Year` - leto 
  - `Pos` - pozicija, na kateri igra košarkar
  - `Age` - starost igralca v izbrani sezoni
  - `G` - odigrane tekme
  - `MP` - odigrane minute
  - `Height` - višina igralca
  - `Weight` - telesna masa igralca
  - `College` - univerza, ki jo je igralec obiskoval pred
  vstopom v ligo NBA
  - `Birth_state` - rojstna (zvezna) država
  
  Ostali stolpci predstavljajo posamezne statistične podatke
  kot so (uspešni) meti za 2 ali 3 točke, prosti meti, podaje,
  skoki, izgubljene žoge, itd. Uporabili smo:
  
  - `AST` - asistence
  - `TRB` - skupni skoki (v napadu in obrambi)
  - `TOV` - izgubljene žoge
  - `PTS` - dosežene točke
  - `BLK` - blokade
  - `STL` - ukradene žoge
  - `3P%` - odstotek uspešnih metov za 3 točke
  - `2P%` - odstotek uspešnih metov za 2 točki
  - `FT%` - odstotek uspešnih prostih metov
  


**Opomba**: da bi razpredelnica `obcine` res bila v obliki *tidy data*, bi morali odstraniti stolpec `gostota` (saj je izpeljan iz stolpcev `povrsina` in `prebivalci`), podatke o pokrajinah pa bi morali premakniti v drugo razpredelnico, saj nekatere občine pripadajo dvema pokrajinama. Podobno bi morali narediti tudi s stolpcem `odcepitev`.

Spodnji graf prikazuje porazdelitev števila naselij v občinah.

```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
ggplot(obcine, aes(x=naselja)) + geom_histogram() +
  ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data=left_join(zemljevid, povprecja, by=c("OB_UIME"="obcina")),
                        aes(x=long, y=lat, group=group, fill=povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill=guide_colorbar(title="Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny, echo=FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
